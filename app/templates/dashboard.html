{% extends "home.html" %}
{% block centermain %}

<style>
    /* ===== Owner Action Buttons ===== */
    .owner-actions {
        display: flex;
        gap: 10px;
    }

    .owner-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: background 0.2s ease, transform 0.15s ease;
    }

    /* Edit */
    .edit-btn {
        background-color: rgba(29, 155, 240, 0.15);
        color: #1d9bf0;
    }

    .edit-btn:hover {
        background-color: rgba(29, 155, 240, 0.25);
        transform: translateY(-1px);
        text-decoration: none;
    }

    /* Delete */
    .delete-btn {
        background-color: rgba(244, 33, 46, 0.15);
        color: #f4212e;
    }

    .delete-btn:hover {
        background-color: rgba(244, 33, 46, 0.25);
        transform: translateY(-1px);
    }

    /* ===== Page Header ===== */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 28px;
    }

    .dashboard-title {
        font-size: 22px;
        font-weight: 700;
    }

    .create-btn {
        padding: 10px 20px;
        border-radius: 999px;
        background-color: #1d9bf0;
        color: #fff;
        font-weight: 600;
        font-size: 14px;
        transition: background 0.2s ease, transform 0.2s ease;
    }

    .create-btn:hover {
        background-color: #1a8cd8;
        transform: translateY(-1px);
        text-decoration: none;
    }

    /* ===== Feed ===== */
    .feed {
        display: flex;
        flex-direction: column;
        gap: 22px;
    }

    /* ===== Blog Card ===== */
    .blog-card {
        background-color: #16181c;
        border: 1px solid #2f3336;
        border-radius: 18px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        transition: background 0.2s ease, transform 0.2s ease;
    }

    .blog-card:hover {
        background-color: #1b1f24;
        transform: translateY(-2px);
    }

    /* ===== Author ===== */
    .blog-author {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: #71767b;
    }

    .author-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #1f2937;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: #1d9bf0;
    }

    /* ===== Content ===== */
    .blog-title {
        font-size: 18px;
        font-weight: 700;
    }

    .blog-desc {
        font-size: 14px;
        line-height: 1.6;
        color: #e7e9ea;
    }

    .blog-image {
        width: 100%;
        border-radius: 14px;
        border: 1px solid #2f3336;
    }

    /* ===== Actions ===== */
    .blog-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 6px;
    }

    .like-area {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .like-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #e7e9ea;
        transition: transform 0.15s ease;
    }

    .like-btn:hover {
        transform: scale(1.1);
    }

    .likes-count {
        font-size: 13px;
        color: #71767b;
    }

    /* ===== Owner Actions ===== */
    .owner-actions {
        display: flex;
        gap: 14px;
    }

    .edit-link {
        color: #1d9bf0;
        font-size: 13px;
        font-weight: 500;
    }

    .edit-link:hover {
        text-decoration: underline;
    }

    .delete-btn {
        background: none;
        border: none;
        color: #f4212e;
        font-size: 13px;
        cursor: pointer;
    }

    .delete-btn:hover {
        text-decoration: underline;
    }
</style>

<!-- ===== Header ===== -->
<section class="dashboard-header">
    <h2 class="dashboard-title">Welcome, {{ user.username }}</h2>
    <a href="{{ url_for('home.create_blog') }}" class="create-btn">Create Blog</a>
</section>

<!-- ===== Feed ===== -->
<section class="feed">
    {% for blog in blogs %}
    <article class="blog-card">

        <!-- Author -->
        <div class="blog-author">
            <div class="author-avatar">
                {{ blog.user.username[0]|upper }}
            </div>
            <span>Blog by <strong>{{ blog.user.username }}</strong></span>
        </div>

        <a href="{{url_for('home.userprofile',user_id=blog.user_id)}}">User Profile</a>

        <form action=" url_for('home.followuser')">
            <button value="blog.user_id">follow</button>
        </form>
        
        <!-- Content -->
        <h3 class="blog-title">{{ blog.title }}</h3>
        <p class="blog-desc">{{ blog.description }}</p>

        {% if blog.image_path %}
        <img src="{{ url_for('static', filename=blog.image_path) }}" alt="Blog image" class="blog-image">
        {% endif %}

        <!-- Actions -->
        <div class="blog-actions">
            <div class="like-area">
                <button class="like-btn" data-blog-id="{{ blog.id }}">
                    {% if blog.id in liked_blog_ids %}
                    ‚ù§Ô∏è
                    {% else %}
                    ü§ç
                    {% endif %}
                </button>
                <span class="likes-count">
                    <span id="likes-count-{{ blog.id }}">{{ blog.likes|length }}</span> likes
                </span>
            </div>

            {% if blog.user_id == user.id %}
            <div class="owner-actions">

                <a href="{{ url_for('home.update_blog', blog_id=blog.id) }}" class="owner-btn edit-btn">
                    ‚úèÔ∏è Edit
                </a>    

                <form method="POST" action="{{ url_for('home.delete_blog') }}"
                    onsubmit="return confirm('Are you sure you want to delete this blog?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button name="delete" value="{{ blog.id }}" class="owner-btn delete-btn">
                        üóëÔ∏è Delete
                    </button>
                </form>

            </div>

            {% endif %}
        </div>

    </article>
    {% endfor %}
</section>

<script>
    const csrfToken = document
        .querySelector('meta[name="csrf-token"]')
        ?.getAttribute('content');

    document.querySelectorAll(".like-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
            const blogId = btn.dataset.blogId;

            const res = await fetch(`/like/${blogId}`, {
                method: "POST",
                headers: { "X-CSRFToken": csrfToken }
            });

            const data = await res.json();
            document.getElementById(`likes-count-${blogId}`).textContent = data.likes_count;
            btn.textContent = data.liked ? "‚ù§Ô∏è" : "ü§ç";
        });
    });
</script>

{% endblock %}

